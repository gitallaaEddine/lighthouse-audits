name: Lighthouse Batch Audit

on:
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install lighthouse-batch
        run: npm install -g lighthouse-batch

      - name: Run lighthouse-batch
        run: |
          # fail early if urls.txt missing
          if [ ! -f urls.txt ]; then echo "ERROR: urls.txt not found" && exit 1; fi

          # run lighthouse-batch on comma-separated URLs from urls.txt
          lighthouse-batch -s "$(paste -sd, urls.txt)"

          # collect generated report files into a single folder for upload
          mkdir -p reports
          mv *.report.json summary.json reports/ || true

      - name: Upload reports
        uses: actions/upload-artifact@v4
        with:
          name: lighthouse-reports
          path: reports
